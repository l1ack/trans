import zmq
import sys
import random
context = zmq.Context()
print("Connecting to server...")
socket = context.socket(zmq.REQ)
socket.connect("tcp://localhost:5555")
import msg_pb2
import datetime

_msg = msg_pb2.Msg()

_msg.sequence = 1

seq = _msg.sequence

while True:
    _msg.payload = str(random.randrange(0,101))
    
    serial = _msg.SerializeToString()

    #print(serial,type(serial))

# _msg.ParseFromString(serial)
    t_dict = {}
    time = datetime.datetime.now()
    time.timestamp()
    t_dict[seq] = time
    seq = seq + 1
    input1 = input("in: ").strip()
    if input1 == 'b':
        sys.exit()
    socket.send(serial)

    message = socket.recv()
    _msg.ParseFromString(message)
    
    time = datetime.datetime.now()
    time.timestamp()
    RTT = time - t_dict[_msg.sequence]
    print("Received reply: "+_msg.payload+"seq: "+str(_msg.sequence)+"RTT: "+str(RTT))
